{% extends "base.html" %}

{% block title %}All Sessions - Claude Session Manager{% endblock %}

{% block content %}
<div>
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">
            {% if query %}
            Search Results for "{{ query }}"
            {% else %}
            All Sessions
            {% endif %}
        </h1>
        <span class="text-gray-400">{{ total }} sessions</span>
    </div>

    {% if sessions %}
    <div class="space-y-3">
        {% for session in sessions %}
        <div class="bg-gray-800 rounded-lg p-4 border {% if session.is_active %}border-green-500/30{% else %}border-gray-700{% endif %} hover:border-gray-600 transition">
            <div class="flex items-start justify-between">
                <div class="flex-1">
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 {% if session.is_active %}bg-green-500{% else %}bg-gray-500{% endif %} rounded-full"></span>
                        <code class="{% if session.is_active %}text-green-400{% else %}text-gray-400{% endif %} text-sm">
                            {{ session.session_id[:8] }}...
                        </code>
                        {% if session.is_active %}
                        <span class="bg-green-600 text-xs px-2 py-0.5 rounded">Active</span>
                        {% endif %}
                    </div>
                    <div class="text-gray-300 mt-1">
                        <span class="text-gray-500">{{ session.project_path }}</span>
                    </div>
                    {% if session.summaries %}
                    <div class="text-gray-400 text-sm mt-2 truncate-2">
                        {{ session.summaries[0] }}
                    </div>
                    {% endif %}
                    <div class="flex items-center space-x-4 text-gray-500 text-xs mt-2">
                        <span>{{ session.start_time.strftime('%Y-%m-%d %H:%M') }}</span>
                        <span>{{ session.message_count }} messages</span>
                        <span>{{ session.model_used or 'Unknown model' }}</span>
                        {% if session.total_input_tokens %}
                        <span>{{ ((session.total_input_tokens + session.total_output_tokens) / 1000)|round|int }}K tokens</span>
                        {% endif %}
                    </div>
                </div>
                <div class="flex space-x-2 ml-4">
                    <a href="/sessions/{{ session.session_id }}"
                       class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm">
                        View
                    </a>
                    <a href="/sessions/{{ session.session_id }}/context"
                       class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm">
                        Context
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="flex justify-center space-x-2 mt-8">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}{% if query %}&q={{ query }}{% endif %}"
           class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded">
            Previous
        </a>
        {% endif %}

        <span class="bg-gray-800 px-4 py-2 rounded text-gray-400">
            Page {{ page }} of {{ total_pages }}
        </span>

        {% if page < total_pages %}
        <a href="?page={{ page + 1 }}{% if query %}&q={{ query }}{% endif %}"
           class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded">
            Next
        </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="text-center py-12 text-gray-500">
        {% if query %}
        No sessions found matching "{{ query }}"
        {% else %}
        No sessions found
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
